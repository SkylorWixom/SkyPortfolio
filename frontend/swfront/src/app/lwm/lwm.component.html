<main class="page-wrapper">
  <div class="page-container learn-with-me">

    <!-- Intro / Title -->
    <section class="lwm-section">
      <h1>Learn with Me: Multiple Subjects</h1>
      <p>
        As a lifelong learner, I'm always exploring new technologies...
      </p>
    </section>

    <!-- Two-column layout -->
    <section class="lwm-section lwm-layout">

      <!-- LEFT NAV: multiple subjects, each with courses -->
      <nav class="lwm-sidebar">
        <div class="subjects-list">
          <div class="subject-item" *ngFor="let subj of subjects">
            <!-- Subject collapsible header -->
            <div
              class="subject-header"
              [class.expanded]="subj.expanded"
              (click)="toggleSubject(subj)"
            >
              {{ subj.subjectTitle }}
              <span class="arrow">{{ subj.expanded ? '▼' : '▶' }}</span>
            </div>

            <!-- If subject is expanded, show its courses -->
            <ul class="courses-list" *ngIf="subj.expanded">
              <li
                *ngFor="let c of subj.courses"
                (click)="selectCourse(c); $event.stopPropagation()"
                [class.selected]="c === selectedCourse"
              >
                {{ c.courseTitle }}
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- RIGHT CONTENT: show the chosen course’s sections -->
      <article class="lwm-content">
        <ng-container *ngIf="selectedCourse; else noCourse">
          <h2>{{ selectedCourse.courseTitle }}</h2>

          <!-- For each section, build an accordion + tabs -->
          <div class="section-accordion" *ngFor="let sec of sectionsEx">
            <!-- Section accordion header -->
            <div class="section-header" (click)="toggleSection(sec)">
              <h4>{{ sec.sectionTitle }}</h4>
              <span class="accordion-arrow">{{ sec.expanded ? '▼' : '▶' }}</span>
            </div>

            <!-- If expanded, show modules & final items -->
            <div class="section-body" *ngIf="sec.expanded">
              <nav class="tabs">
                <button
                  *ngFor="let mod of sec.modules"
                  [class.active]="sec.activeTab === mod.moduleTitle"
                  (click)="setActiveTab(sec, mod.moduleTitle); $event.stopPropagation()"
                >
                  {{ mod.moduleTitle }}
                </button>
              </nav>

              <!-- The final items for whichever module is active -->
              <div class="tab-content">
                <ng-container *ngFor="let mod of sec.modules">
                  <div *ngIf="sec.activeTab === mod.moduleTitle">
                    <ul class="final-items">
                      <li
                        *ngFor="let fi of mod.finalItems"
                        (click)="onFinalItemClick(fi); $event.stopPropagation()"
                      >
                        <!-- Could also show fi.description or fi.videoUrl if you like -->
                        <strong>{{ fi.title }}</strong>
                        <small>{{ fi.content }}</small>
                      </li>
                    </ul>
                  </div>
                </ng-container>
              </div>
            </div>
          </div><!-- end sections loop -->

        </ng-container>
        <ng-template #noCourse>
          <p>Select a course on the left.</p>
        </ng-template>
      </article>
    </section>
  </div>
</main>

<!-- (A) The modal overlay. We only show it if isModalOpen = true. -->
<div class="modal-overlay" *ngIf="isModalOpen">
  <div class="modal-container">
    <button class="close-btn" (click)="closeModal()">✕</button>

    <!-- If we have a selectedFinalItem, show it here -->
    <div *ngIf="selectedFinalItem">
      <h2>{{ selectedFinalItem.title }}</h2>

      <!-- If description is present, show it. -->
      <p *ngIf="selectedFinalItem.description">{{ selectedFinalItem.description }}</p>

      <!-- If content is present, you can also show that, or merge them. -->
      <p *ngIf="selectedFinalItem.content">{{ selectedFinalItem.content }}</p>

      <iframe 
      width="560" 
      height="315"
      *ngIf="selectedFinalItem.videoUrl"
      [src]="selectedFinalItem.videoUrl | safeUrl"
      frameborder="0"
      allowfullscreen
    ></iframe>
    
    </div>
  </div>
</div>
